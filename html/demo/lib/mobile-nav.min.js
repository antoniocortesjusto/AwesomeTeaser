angular.module("mobile-navigate",[]);angular.module("mobile-navigate").factory("$change",["$q","$rootScope",function($q,$rootScope){var transitionPresets={modal:["modal",""],none:["",""]},defaultOptions={prefix:"mb-"},IN_CLASS="in",OUT_CLASS="out",REVERSE_CLASS="reverse",DONE_CLASS="done",ANIMATION_END="webkitAnimationEnd";return function change(next,prev,transType,reverse,options){options=angular.extend(options||{},defaultOptions);var deferred=$q.defer(),nextTransClass,prevTransClass;function buildClassString(classes){return classes.reduce(function(accumulator,cls){return accumulator+(cls?" "+options.prefix+cls:"")},"")}var transition=transitionPresets[transType]?transitionPresets[transType]:[transType,transType];next.css("z-index","-100");next[0].offsetWidth+=0;var nextClasses=buildClassString([reverse?OUT_CLASS:IN_CLASS,nextTransClass=transition[reverse?1:0],reverse&&REVERSE_CLASS||""]);next.addClass(nextClasses);var prevClasses;if(prev){prevClasses=buildClassString([reverse?IN_CLASS:OUT_CLASS,prevTransClass=transition[reverse?0:1],reverse&&REVERSE_CLASS||""]);prev.addClass(prevClasses)}next.css("z-index","");next[0].offsetWidth+=0;function done(){$rootScope.$apply(function(){deferred.resolve()})}var boundElement;if(nextTransClass&&nextTransClass.length){(boundElement=next).bind(ANIMATION_END,done)}else if(prev&&prevTransClass&&prevTransClass.length){(boundElement=prev).bind(ANIMATION_END,done)}else{deferred.resolve()}deferred.promise.then(function(){boundElement&&boundElement.unbind(ANIMATION_END,done);next.removeClass(nextClasses);prev&&prev.removeClass(prevClasses)});deferred.promise.cancel=function(){deferred.resolve()};return deferred.promise}}]);angular.module("mobile-navigate").service("$navigate",["$rootScope","$location","$route",function($rootScope,$location,$route){var self=this,navHistory=[];function Page(path,transition,isReverse){var _path=path,_transition=transition||"slide",_isReverse=isReverse,_onceTransition;this.transition=function(){var trans;if(_onceTransition){trans=_onceTransition;_onceTransition=null}else{trans=_transition}return trans};this.path=function(){return _path};this.reverse=function(){return _isReverse};this.transitionOnce=function(trans){_onceTransition=trans}}function navigate(destination,source,isBack){$rootScope.$broadcast("$pageTransitionStart",destination,source,isBack);self.current=self.next}self.onRouteSuccess=null;function defaultRouteSuccess($event,next,last){self.current&&navHistory.push(self.current);self.next=new Page($location.path());self.next.transitionOnce("none");navigate(self.next);self.onRouteSuccess=null}$rootScope.$on("$routeChangeSuccess",function($event,next,last){if(!next.$$route||!next.$$route.redirectTo){(self.onRouteSuccess||defaultRouteSuccess)($event,next,last)}});self.go=function go(path,transition,isReverse){if(typeof transition=="boolean"){isReverse=transition;transition=null}$location.path(path);self.onRouteSuccess=function($event,next,last){self.current&&navHistory.push(self.current);self.next=new Page(path,transition||next.$$route&&next.$$route.transition,isReverse);navigate(self.next,self.current,false)}};self.eraseHistory=function(){navHistory.length=0};self.back=function(){if(navHistory.length>0){var previous=navHistory[navHistory.length-1];$location.path(previous.path());self.onRouteSuccess=function(){navHistory.pop();self.next=previous;navigate(self.next,self.current,true)};return true}return false};document.addEventListener("deviceready",function(){document.addEventListener("backbutton",function(){var backSuccess=self.back();if(!backSuccess){navigator.app.exitApp()}})})}]);angular.module("mobile-navigate").directive("mobileView",["$rootScope","$compile","$controller","$route","$change",function($rootScope,$compile,$controller,$route,$change){function link(scope,viewElement,attrs){function insertPage(page){var current=$route.current,locals=current&&current.locals;page.element=angular.element(document.createElement("div"));page.element.html(locals.$template);page.element.addClass("mb-page");page.scope=scope.$new();if(current.controller){locals.$scope=page.scope;page.controller=$controller(current.controller,locals);page.element.contents().data("$ngControllerController",page.controller)}$compile(page.element.contents())(page.scope);if(locals&&locals.$template){viewElement.append(page.element)}page.scope.$emit("$viewContentLoaded");page.scope.$eval(attrs.onLoad)}var currentTrans;scope.$on("$pageTransitionStart",function($event,dest,source,reverse){function changePage(){var current=$route.current?$route.current.$$route:{};var transition=reverse?source.transition():dest.transition();insertPage(dest);if(dest.reverse()||current.reverse){reverse=!reverse}var promise=$change(dest.element,source?source.element:null,transition,reverse);promise.then(function(){if(source){$rootScope.$broadcast("$pageTransitionSuccess",dest,source);source.scope.$destroy();source.element.remove();source=undefined}});return promise}currentTrans&&currentTrans.cancel();currentTrans=changePage(dest,source,reverse)})}return{restrict:"EA",link:link}}]).directive("scrollable",function($route){var scrollCache={};return{restrict:"EA",link:function(scope,elm,attrs){var route=$route.current?$route.current.$$route:{};var template=route.templateUrl||route.template;var rawElm=elm[0];if(template){setTimeout(function(){var oldScroll=scrollCache[template];if(oldScroll){rawElm.scrollTop=oldScroll}});scope.$on("$destroy",function(){scrollCache[template]=rawElm.scrollTop})}}}});